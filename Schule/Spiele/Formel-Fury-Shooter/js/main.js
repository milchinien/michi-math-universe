/**
 * FORMEL-FURY-SHOOTER - MAIN INITIALIZATION
 * Entry point and game initialization
 * Phase 4.2: Modulare Struktur
 */

// Initialize game modules when page loads (but don't start the game yet)
window.addEventListener('load', () => {
    console.log('üéÆ Formel-Fury-Shooter initializing...');
    console.log('üìÅ Loading modular structure...');
    
    try {
        // Verify all required classes are loaded
        if (typeof FormulaSystem === 'undefined') {
            throw new Error('FormulaSystem class not loaded');
        }
        if (typeof Enemy === 'undefined') {
            throw new Error('Enemy class not loaded');
        }
        if (typeof EnemySpawner === 'undefined') {
            throw new Error('EnemySpawner class not loaded');
        }
        if (typeof CurrencySystem === 'undefined') {
            throw new Error('CurrencySystem class not loaded');
        }
        if (typeof WaveSystem === 'undefined') {
            throw new Error('WaveSystem class not loaded');
        }
        if (typeof LevelSystem === 'undefined') {
            throw new Error('LevelSystem class not loaded');
        }
        if (typeof Player === 'undefined') {
            throw new Error('Player class not loaded');
        }
        if (typeof InputHandler === 'undefined') {
            throw new Error('InputHandler class not loaded');
        }
        if (typeof ArenaSystem === 'undefined') {
            throw new Error('ArenaSystem class not loaded');
        }
        if (typeof GameEngine === 'undefined') {
            throw new Error('GameEngine class not loaded');
        }
        
        console.log('‚úÖ All modules loaded successfully');
        console.log('üìö Class selection menu is now active');
        console.log('üîß Game engine ready to initialize after class selection');
        
        // Don't start the game immediately - wait for class selection
        // The game will be initialized by the ClassSelectionSystem
        
    } catch (error) {
        console.error('‚ùå Failed to initialize game modules:', error);
        alert('Fehler beim Laden des Spiels!\n\n' + error.message + '\n\nBitte √ºberpr√ºfe, ob alle Dateien korrekt geladen wurden.');
    }
});

// Function to initialize the actual game (called by ClassSelectionSystem)
window.initializeFormelFuryShooter = function() {
    console.log('üöÄ Starting Formel-Fury-Shooter...');
    
    try {
        // Initialize the game engine
        const game = new GameEngine();
        console.log('‚úÖ Game engine started successfully!');
        
        // Make game accessible globally for debugging and menu functions
        window.game = game;
        window.gameEngine = game;
        
        // Currency system is now ready and integrated
        console.log('üí∞ CurrencySystem loaded and ready');
        
        console.log('üöÄ Formel-Fury-Shooter ready to play!');
        console.log('üîß Debug: All systems operational');
        
        return game;
        
    } catch (error) {
        console.error('‚ùå Failed to start game:', error);
        alert('Fehler beim Starten des Spiels!\n\n' + error.message);
        return null;
    }
};
